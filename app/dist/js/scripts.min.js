!function(a){var b={$height:a(window).height()-230+"px",construct:function(){this.minHeightWrap(),this.search(),this.menuMobile()},minHeightWrap:function(){a("#wrap").css("min-height",this.$height),a(window).resize(function(){heig=a(window).height()-230+"px",a("#wrap").css("min-height",heig)})},search:function(){a(".sch label").click(function(){0===a(".sch #s").width()&&a("body").addClass("open-search")}),a(".sch #s").focusout(function(){var b=a(this).val();a("body").hasClass("open-search")&&""===b&&a("body").removeClass("open-search")})},menuMobile:function(){var b="";b+="<ul>",b+="<li>"+a(".app-navbar .nv .op .sch").html()+"</li>",b+=a(".app-navbar .nv .menu ul").html(),b+=a(".app-navbar .nv .op .dropdown .dropdown-menu").html(),b+="</ul>";var c=!1;a(window).resize(function(){a(window).width()<=991&&(c=!0)}),c===!0||a(window).width()<=991?a(".menu-mobile").html(b,function(){}):a(".menu-mobile").html(""),a(".btn-menu").click(function(){a("body").hasClass("open-menu")?a("body").removeClass("open-menu"):a("body").addClass("open-menu")})}},c=b;c.construct(),console.log(c)}(jQuery),function(a){var b={menuActive:function(b){var c=a(".menu ul");c.find("li").removeClass("active"),c.find('a[href="#/'+b+'"]').parent().addClass("active")},helperTabs:function(){a('a[data-toggle="tab"]').click(function(b){b.preventDefault(),a(".nav-tabs a").parent().removeClass("active"),a(".nav-tabs a[aria-controls="+a(this).attr("aria-controls")+"]").parent().addClass("active"),a(".tab-content .tab-pane").removeClass("active"),a(".tab-content .tab-pane[id="+a(this).attr("aria-controls")+"]").addClass("active")})},helperMaskInput:function(){a(".mask-tel").mask("(99) 9999-9999?9"),a(".mask-cep").mask("99999-999"),a(".mask-cpf").mask("999.999.999-99"),a(".mask-uf").mask("**"),a(".mask-num").mask("9?999999999")},helperAlert:function(b,c,d,e){a(e).addClass("disabled").attr("disabled","disabled"),a("body").append("<div id='alert' style='width: 100%; height: 100px; position: fixed; top: -100%; left: 0; background: "+c+"; z-index: 99999;'><h1>"+b+"</h1></div>"),a("#alert h1").css({color:d,display:"none"}),a("#alert").animate({top:"0"},500,function(){a("#alert h1").fadeIn(800),setTimeout(function(){a("#alert h1").hide(),a("#alert").animate({top:"-100%"},600,function(){a(this).remove()}),a(e).removeClass("disabled").removeAttr("disabled")},5e3)})},helperSearchCep:function(){a(".sh-cep").on("click",function(){var c=a(this).closest(".serch-cep").find(".mask-cep").val();if(""===c)return a(this).closest(".serch-cep").find(".mask-cep").focus(),b.helperAlert("Informe o número do CEP","#FCA464","#FFFFFF",".sh-cep"),!1;var d=a(this).closest("fieldset");a.getJSON("http://viacep.com.br/ws/"+c.replace(/[\(\)\.\s-]+/g,"")+"/json/ ",function(a){console.log(a),d.find(".rs").val(a.logradouro),d.find(".bs").val(a.bairro),d.find(".cs").val(a.localidade),d.find(".us").val(a.uf),d.find(".auto").removeAttr("disabled")})})},helperCloneFields:function(){a("#insum").on("click",".btn-clone",function(){a("div.form-group.clone").last().clone().appendTo(a("#insum .group")).find("input").attr("name",function(a,b){return b.replace(/\[(\d+)\]/,function(a,b){return"["+(+b+1)+"]"})})}),a("#insum").on("click",".btn-remove",function(){a(this).closest("div.form-group.clone").remove()})},helperRoundMoney:function(a){return a=100*parseFloat(a),Math.floor(a)/100},helperDateFormat:function(a){function b(a){return a<10?"0"+a:""+a}var c=new Date(a);return b(c.getDate())+"/"+b(c.getMonth()+1)+"/"+c.getFullYear()+" "+b(c.getHours())+":"+b(c.getMinutes())+":"+b(c.getSeconds())},helpersWidget:function(a,b){var c='<div class="col-xs-12 col-sm-6 col-md-5 col-lg-3">';return c+='<div class="panel panel-default">',c+='<div class="panel-heading">'+b+"</div>",c+='<div class="panel-body">',c+=a,c+="</div>",c+="</div>",c+="</div>"},admin:function(){var b="SELECT * FROM solicitantes ORDER BY nome DESC";mysqlQuery(b,function(b){var c=JSON.parse(b),d="";a.each(c,function(a,b){d+="<tr>",d+="<td>"+b.id+"</td>",d+="<td>"+b.nome+"</td>",d+="<td>"+b.telefone+"</td>",d+="<td>"+b.cidade+"</td>",d+="</tr>"}),a("#solicitantes").html(d)})},getOrdersCustomer:function(c){void 0===c&&(c="10");var d="SELECT pedido.id, solicitante.nome AS nomeSol, material.nome AS nomeMat, material.preco AS precoMat FROM pedidos AS pedido INNER JOIN materiais AS material ON material.id_pedido = pedido.id INNER JOIN solicitantes AS solicitante ON solicitante.id = pedido.id_solicitante WHERE pedido.id_solicitante = solicitante.id ORDER BY pedido.data_de_compra DESC LIMIT "+c;mysqlQuery(d,function(c){var d=JSON.parse(c);if(0!==d.length){var e='<table class="table table-striped">';e+="<thead>",e+="<tr>",e+="<th>Material</th>",e+="<th>Nome</th>",e+="<th>Preço</th>",e+="</tr>",e+="</thead>",e+="<tbody>",a.each(d,function(a,b){e+="<tr>",e+="<td>"+b.nomeMat+"</td>",e+='<td><a href="#/pedido/id/'+b.id+'">'+b.nomeSol+"</a></td>",e+="<td>R$ "+b.precoMat+"</td>",e+="</tr>"}),e+="</tbody>",e+="</table>";var f=b.helpersWidget(e,"Últimos Pedidos");a(".widgets").append(f)}})},getOrdersDay:function(){var c="SELECT COUNT(*) AS total, CURDATE() AS data FROM pedidos WHERE data_de_compra = CURDATE() ";mysqlQuery(c,function(c){var d=JSON.parse(c);if(0!==d.length){var e="";a.each(d,function(a,c){var d='<div class="pull-left"><input data-readOnly="true" data-fgColor="#39BB9D" value="'+c.total+'" class="dial"></div>';d+='<div class="info"><h3>Total de <span class="green-color">'+c.total+"</span> Pedidos</h3>",d+='<span class="date">Data '+b.helperDateFormat(c.data)+"</span></div>",e=b.helpersWidget(d,"Pedidos de Hoje")}),a(".widgets").html(e)}})},getOrder:function(c){var d="SELECT pedido.id AS id, pedido.id_solicitante AS idSoli, pedido.data_de_compra AS data, pedido.cep AS cepPed, pedido.rua AS ruaPed, pedido.numero AS numeroPed, pedido.bairro AS bairroPed, pedido.cidade AS cidadePed, pedido.estado AS estadoPed, pedido.pais AS paisPed, material.nome AS nomeMat, material.marca AS marcaMat, material.preco AS precoMat, material.quantidade AS qtdMat, solicitante.nome AS nomeSol, solicitante.cpf AS cpfSol, solicitante.cep AS cepSol, solicitante.rua AS ruaSol, solicitante.numero AS numeroSol, solicitante.bairro AS bairroSol, solicitante.cidade AS cidadeSol, solicitante.estado AS estadoSol, solicitante.pais AS paisSol, solicitante.telefone AS telSol FROM pedidos AS pedido INNER JOIN materiais AS material ON material.id_pedido = pedido.id INNER JOIN solicitantes AS solicitante ON solicitante.id = pedido.id_solicitante WHERE pedido.id = "+c+" GROUP BY pedido.id",e="SELECT insumo.descricao AS descIns, insumo.quantidade AS qtdIns, insumo.preco AS precoIns, material.marca AS marcaIns FROM insumos AS insumo INNER JOIN materiais AS material ON material.id = insumo.id_material WHERE insumo.id_pedido = "+c,f="SELECT (material.preco * material.quantidade) AS precoMaterial, SUM(insumo.preco * insumo.quantidade) AS precoInsumo FROM materiais AS material INNER JOIN insumos AS insumo ON insumo.id_pedido = "+c+" WHERE material.id_pedido = "+c+" GROUP BY material.id_pedido",g="",h="";mysqlQuery(e,function(b){var c=JSON.parse(b);0!==c.length&&a.each(c,function(a,b){g+='<div class="form-group">',g+='<div class="col-xs-12 col-sm-6 col-md-3 col-lg-2"><label>Marca</label><input type="text" class="form-control" value="'+b.marcaIns+'"></div>',g+='<div class="col-xs-12 col-sm-6 col-md-5 col-lg-4"><label>Descrição</label><input type="text" class="form-control" value="'+b.descIns+'"></div>',g+='<div class="col-xs-12 col-sm-6 col-md-3 col-lg-2"><label>Quantidade</label><input type="text" class="form-control" value="'+b.qtdIns+'"></div>',g+='<div class="col-xs-12 col-sm-6 col-md-3 col-lg-2"><label>Preço</label><input type="text" class="form-control mask-money" value="R$ '+b.precoIns+'"></div>',g+="</div>"})}),mysqlQuery(f,function(b){console.log(b);var c=JSON.parse(b);0!==c.length&&a.each(c,function(a,b){h=b.precoMaterial+b.precoInsumo})}),mysqlQuery(d,function(c){var d=JSON.parse(c),e="";0!==d.length?(a.each(d,function(a,c){e+='<ul class="nav nav-tabs" role="tablist">',e+='<li role="presentation" class="active"><a href="#mater" aria-controls="mater" role="tab" data-toggle="tab">Dados do Pedido</a></li>',e+='<li role="presentation"><a href="#insum" aria-controls="insum" role="tab" data-toggle="tab">Dados do Insumo</a></li>',e+='<li role="presentation"><a href="#solic" aria-controls="solic" role="tab" data-toggle="tab">Dados do Solicitante</a></li>',e+='<li role="presentation"><a href="#entr" aria-controls="entr" role="tab" data-toggle="tab">Dados da Entrega</a></li>',e+="</ul>",e+='<div class="form-group">',e+='<h3 class="priceTotal">Preço Total: R$ '+b.helperRoundMoney(h)+"</h3>",e+="</div>",e+='<div class="tab-content">',e+='<fieldset role="tabpanel" id="mater" class="mat tab-pane active"">',e+='<div class="form-group">',e+='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><label>Material</label><input type="text" class="form-control" value="'+c.nomeMat+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-3 col-lg-2"><label>Marca</label><input type="text" class="form-control" value="'+c.marcaMat+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-3 col-lg-2"><label>Data da Compra</label><input type="text" class="form-control mask-date" value="'+b.helperDateFormat(c.data)+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-3 col-lg-2"><label>Quantidade</label><input type="text" class="form-control" value="'+c.qtdMat+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-3 col-lg-2"><label>Preço '+c.nomeMat+'</label><input type="text" class="form-control mask-money" value="R$ '+c.precoMat+'"></div>',e+="</div>",e+="</fieldset>",e+='<fieldset role="tabpanel" id="insum" class="mat tab-pane"">',e+=g,e+="</fieldset>",e+='<fieldset role="tabpanel" id="solic" class="mat tab-pane">',e+='<div class="form-group">',e+='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><label>Nome</label><input type="text" class="form-control" value="'+c.nomeSol+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><label>CPF</label><input type="text" class="form-control mask-cpf" value="'+c.cpfSol+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><label>Telefone</label><input type="text" class="form-control mask-tel" value="'+c.telSol+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-3 col-lg-2"><label>CEP</label><input type="text" class="form-control mask-cep" value="'+c.cepSol+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><label>Rua</label><input type="text" class="form-control" value="'+c.ruaSol+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-2 col-lg-1"><label>Número</label><input type="text" class="form-control" value="'+c.numeroSol+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><label>Bairro</label><input type="text" class="form-control" value="'+c.bairroSol+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><label>Cidade</label><input type="text" class="form-control" value="'+c.cidadeSol+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-2 col-lg-1"><label>Estado</label><input type="text" class="form-control mask-uf" value="'+c.estadoSol+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><label>País</label><input type="text" class="form-control" value="'+c.paisSol+'"></div>',e+="</div>",e+="</fieldset>",e+='<fieldset  role="tabpanel" id="entr"  class="mat tab-pane">',e+='<div class="form-group">',e+='<div class="col-xs-12 col-sm-6 col-md-3 col-lg-2"><label>CEP</label><input type="text" class="form-control mask-cep" value="'+c.cepPed+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><label>Rua</label><input type="text" class="form-control" value="'+c.ruaPed+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-2 col-lg-1"><label>Número</label><input type="text" class="form-control" value="'+c.numeroPed+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><label>Bairro</label><input type="text" class="form-control" value="'+c.bairroPed+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><label>Cidade</label><input type="text" class="form-control" value="'+c.cidadePed+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-2 col-lg-1"><label>Estado</label><input type="text" class="form-control mask-uf" value="'+c.estadoPed+'"></div>',e+='<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3"><label>País</label><input type="text" class="form-control" value="'+c.paisPed+'"></div>',e+="</div>",e+="</fieldset>",e+="</div>"}),a(".results").html(e)):(e+='<h3 class="text-center">Não exite pedido para o código informado.</h3>',e+='<form method="post" action="#/pedido" class="seach-order"><fieldset>',e+='<div class="form-group">',e+='<div class="col-xs-6 col-md-8">',e+='<input type="text" name="id" id="id" class="form-control mask-num" placeholder="Número do Pedido">',e+="</div>",e+='<div class="col-xs-6 col-md-4">',e+='<button type="submit" id="ped" class="btn btn-green c">Buscar</button>',e+="</div>",e+="</div></fieldset></form>",a("#content").html(e))})}},c=a.sammy("#wrap",function(){this.helpers({animated:function(a,b){this.swap=function(c){this.$element().html(c).find(a).addClass(b)}}}),this.get("#/",function(){b.menuActive(""),this.partial("views/index.html",function(){a(".mask-num").mask("9?999999999"),b.getOrdersDay(),b.getOrdersDay(),a(".dial").knob(),b.getOrdersCustomer("2")})}),this.get("#/admin",function(){b.menuActive("admin"),this.partial("views/admin.html",function(){b.admin()})}),this.post("#/pedido",function(){var a=this.params.id;this.redirect("#/pedido/id",a)}),this.get("#/pedido/id/:id",function(){b.menuActive(""),c.clearTemplateCache();var d=this.params.id;this.partial("views/pedido.html",function(){b.getOrder(d),a(".cod").html(d),b.helperMaskInput(),b.helperTabs()})}),this.get("#/novo/pedido",function(){b.menuActive(""),this.partial("views/novo-pedido.html",function(){b.helperTabs(),b.helperMaskInput(),b.helperSearchCep(),b.helperCloneFields()})}),this.get("",function(){b.menuActive("404"),this.partial("views/404.html")})});a(function(){c.run("#/")})}(jQuery);