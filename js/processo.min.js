function atualizaValorTotal(){var a=0;$("#tBodyInsumo tr").each(function(b,c){var c=$(c),d=parseInt(c.find(".celQ").text()),e=parseFloat(c.find(".celV").text().replace(",","."));a=parseFloat(a)+parseFloat(d*e)});var b=(parseFloat(a.toFixed(2))+parseFloat(valPedido)).toFixed(2);$("#valorInsumos").html("R$ "+a.toFixed(2).toString().replace(".",",")),$("#valorTotal").html("R$ "+b.toString().replace(".",","))}function buscaPedido(a){var b="SELECT\n                     p.id, p.data_de_compra, p.cep, p.rua, p.numero,\n                     p.bairro, p.cidade, p.estado, s.nome, s.telefone \n                FROM \n                    pedidos p \n                        INNER JOIN solicitantes s ON s.id = p.id_solicitante \n                WHERE \n                    p.id = "+a;mysqlQuery(b,function(a){var b=JSON.parse(a);b.length>0?($("#alertPedido").hide(),b=b[0],$("#modalPedidoLabel").html("Pedido "+b.id),$("#resBuscaIdpedido").val(b.id),$("#resBuscaDataCompra").val(b.data_de_compra),$("#resBuscaNome").val(b.nome),$("#resBuscaTel").val(b.telefone),$("#resBuscaRua").val(b.rua),$("#resBuscaNumero").val(b.numero),$("#resBuscaBairro").val(b.bairro),$("#resBuscaCidade").val(b.cidade),$("#resBuscaEstado").val(b.estado),$("#modalPedido").modal("show")):$("#alertPedido").show()})}function addInsumo(){if(formValidate($("#formInsumos"))){var a=formSerialize($("#formInsumos")),b=$("#insumoMarca option:selected").text(),c="";c=a.insumoPreco.indexOf(",")>-1?a.insumoPreco:a.insumoPreco+",00";var d="<tr><td><a href='#' class='remove-insumo'><span class='glyphicon glyphicon-remove'></span></a></td><td>"+b+"</td><td>"+a.insumoDesc+"</td><td class='celQ'>"+a.insumoQnt+"</td><td class='celV'>"+c+"</td></tr>";$("#tBodyInsumo").append(d),$(".remove-insumo").click(function(a){a.preventDefault(),$(this).closest("tr").remove(),atualizaValorTotal()})}}function formValidate(a){var b=a.serializeArray(),c=0;for(var d in b){var e=$("#"+b[d].name);e.hasClass("not-required")||""!=e.val()&&null!=e.val()?(e.parent().removeClass("has-error"),e.parent().addClass("has-success")):(e.parent().removeClass("has-success"),e.parent().addClass("has-error"),c++)}return 0==c}function maskElements(){$(".preco").mask("000.000.000.000.000,00",{reverse:!0}),$(".cep").mask("00000-000",{reverse:!1}),$("#solicCpf").mask("000.000.000-00",{reverse:!0}),$("#solicTel").mask("(00) 0000-0000",{reverse:!1})}function formSerialize(a){a=a.serializeArray();var b=new Array;for(var c in a)b[a[c].name]=a[c].value;return b}function mesmoEndereco(a){if(a){var b=$("#solicCep").val(),c=$("#solicEndereco").val(),d=$("#solicComp").val(),e=$("#solicEstado").val(),f=$("#solicCidade").val();$("#entregaCep").val(b),$("#entregaEndereco").val(c),$("#entregaComp").val(d),$("#entregaEstado").val(e),$("#entregaCidade").val(f)}else $("#entregaCep").val(""),$("#entregaEndereco").val(""),$("#entregaComp").val(""),$("#entregaEstado").val(""),$("#entregaCidade").val("")}function buscaCep(a,b,c,d,e,f){var g=a.val();$.ajax({type:"GET",url:"https://viacep.com.br/ws/"+g+"/json/",success:function(a){$(".p-loading").hide(),$(f).hide(),a.erro?$(f).show():($(b).val(a.logradouro),$(c).val(a.complemento),$(d).val(a.uf),$(e).val(a.localidade))},error:function(){$(".p-loading").hide(),$(f).show()},beforeSend:function(){$(".p-loading").show()}})}$(document).ready(function(){maskElements(),valPedido=0,$("#buscarPedido").click(function(){var a=$("#inputBusca").val();buscaPedido(a)}),$(".btnPrev").click(function(){$(".nav-tabs > .active").prev("li").find("a").trigger("click")}),$("#btnNextPedido").click(function(){if(formValidate($("#formPedido"))){var a=parseInt($("#pedidoQntMat").val()),b=parseFloat($("#pedidoPreco").val().replace(",","."));valPedido=(a*b).toFixed(2),atualizaValorTotal(),$("#valorPedido").html("R$ "+valPedido.replace(".",",")),$(".tab-item").removeClass("active"),$("#insumos-tab").attr("data-toggle","tab"),$("#insumos-tab").parent().fadeIn(),$("#insumos-tab").tab("show")}}),$("#btnNextInsumo").click(function(){$(".table-insumos tr").length>=3?formValidate($("#formInsumos"))&&($(".tab-item").removeClass("active"),$("#solicitante-tab").attr("data-toggle","tab"),$("#solicitante-tab").parent().fadeIn(),$("#solicitante-tab").tab("show"),$("#alertInsumos").hide()):$("#alertInsumos").show()}),$("#btnNextSolic").click(function(){formValidate($("#formSolicitante"))&&($(".tab-item").removeClass("active"),$("#entrega-tab").attr("data-toggle","tab"),$("#entrega-tab").parent().fadeIn(),$("#entrega-tab").tab("show"))}),$("#btnNextEntrega").click(function(){formValidate($("#formEntrega"))&&($(".tab-item").removeClass("active"),$("#finalizado-tab").attr("data-toggle","tab"),$("#finalizado-tab").parent().fadeIn(),$("#finalizado-tab").tab("show"))}),$("#pedidoDataCompra").datepicker({dateFormat:"dd/mm/yy",dayNamesMin:["D","S","T","Q","Q","S","S","D"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","SÃ¡b","Dom"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],changeMonth:!0,changeYear:!0}),$(".remove-insumo").click(function(a){a.preventDefault(),$(this).closest("tr").remove(),atualizaValorTotal()}),$(".tab").tab(),$("#btnBuscaCepSolic").click(function(){var a=$("#solicCep"),b=$("#solicEndereco"),c=$("#solicComp"),d=$("#solicEstado"),e=$("#solicCidade"),f=$("#alertSolic");buscaCep(a,b,c,d,e,f)}),$("#btnBuscaCepEnt").click(function(){var a=$("#entregaCep"),b=$("#entregaEndereco"),c=$("#entregaComp"),d=$("#entregaEstado"),e=$("#entregaCidade"),f=$("#alertEntrega");buscaCep(a,b,c,d,e,f)}),$("#mesmoEndereco").on("change",function(){var a=$(this).prop("checked");mesmoEndereco(a)}),$("#incluirInsumo").click(function(){addInsumo(),atualizaValorTotal()})});