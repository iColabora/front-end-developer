var Database={fetchAllPedidos:function(e){this._execute("select p.numero, p.id, p.id_solicitante, s.nome, DATE_FORMAT(STR_TO_DATE(p.data_de_compra, '%Y-%m-%d'), '%d-%m-%Y') as data_de_compra, (SELECT SUM (m.quantidade*m.preco) FROM materiais as m WHERE m.id_pedido = p.id) as total_materiais, (SELECT SUM (i.quantidade*i.preco) FROM insumos as i WHERE i.id_pedido = p.id) as total_insumos from pedidos as p INNER JOIN solicitantes as s ON s.id = p.id_solicitante",e)},findPedidoById:function(e,i){var a="select p.numero, p.id, p.id_solicitante, s.nome, DATE_FORMAT(STR_TO_DATE(p.data_de_compra, '%Y-%m-%d'), '%d-%m-%Y') as data_de_compra, (SELECT SUM (m.quantidade*m.preco) FROM materiais as m WHERE m.id_pedido = p.id) as total_materiais, (SELECT SUM (i.quantidade*i.preco) FROM insumos as i WHERE i.id_pedido = p.id) as total_insumos from pedidos as p INNER JOIN solicitantes as s ON s.id = p.id_solicitante WHERE p.id = "+e;this._execute(a,i)},findMaterialByIdPedido:function(e,i){var a="SELECT * FROM materiais WHERE id_pedido = "+e;this._execute(a,i)},findInsumoByIdPedido:function(e,i){var a="SELECT * FROM insumos WHERE id_pedido = "+e;this._execute(a,i)},findSolicitanteById:function(e,i){var a="SELECT * FROM solicitantes WHERE id = "+e;this._execute(a,i)},findSolicitanteByCpf:function(e,i){var a="SELECT * FROM solicitantes WHERE cpf = "+e;this._execute(a,i)},fetchAllSolicitantes:function(e){this._execute("SELECT * FROM solicitantes",e)},fetchPedidosPorDia:function(e){this._execute("select count(*) as total, day(STR_TO_DATE(data_de_compra, '%Y-%m-%d')) as day from pedidos p group by day(STR_TO_DATE(data_de_compra, '%Y-%m-%d'))",e)},fetchPedidosPorSolicitantes:function(e){this._execute("select count(*) total, s.nome from pedidos p inner join solicitantes s on s.id = p.id_solicitante group by p.id_solicitante",e)},insertPedido:function(e,i){var a="INSERT INTO pedidos (id_solicitante, data_de_compra, cep, rua, numero, bairro, cidade, estado, pais) VALUES ("+e.id_solicitante+", '"+e.data_de_compra+"', '"+e.cep+"', '"+e.rua+"', '"+e.numero+"', '"+e.bairro+"', '"+e.cidade+"', '"+e.estado+"', '"+e.pais+"')";this._execute(a,i)},insertSolicitante:function(e,i){var a="INSERT INTO solicitantes (nome, telefone, cpf, cep, rua, numero, bairro, cidade, estado, pais) VALUES ('"+e.nome+"', '"+e.telefone+"', '"+e.cpf+"', '"+e.cep+"', '"+e.rua+"', "+e.numero+", '"+e.bairro+"', '"+e.cidade+"', '"+e.cidade+"', '"+e.estado+"', '"+e.pais+"')";this._execute(a,i)},insertMaterial:function(e,i,a){var t="INSERT INTO materiais (id_pedido, nome, marca, preco, quantidade) VALUES ("+e+", '"+i.nome+"', '"+i.marca+"', '"+i.marca+"', "+i.preco+", "+i.quantidade+")";this._execute(t,a)},insertInsumo:function(e,i,a){var t="INSERT INTO insumos (id_pedido, id_material, descricao, preco, quantidade) VALUES ("+e+", '"+i.id_material+"', '"+i.descricao+"', "+i.preco+", "+i.quantidade+")";this._execute(t,a)},updatePedido:function(e,i,a){var t="UPDATE pedidos SET id_solicitante = "+i.id_solicitante+", data_de_compra = '"+i.data_de_compra+"', cep = '"+i.cep+"', ";t+="rua = '"+i.rua+"', numero = "+i.numero+", bairro = '"+i.bairro+"', cidade = '"+i.cidade+"', estado = '"+i.estado+"', ",t+="pais = '"+i.pais+"' WHERE id = "+e,this._execute(t,a)},updateSolicitante:function(e,i){var a="UPDATE solicitantes SET nome = '"+e.nome+"', telefone = '"+e.telefone+"', cpf = '"+e.cpf+"', cep = '"+e.cep+"', ";a+="rua = '"+e.rua+"', numero = "+e.numero+", bairro = '"+e.bairro+"', cidade = '"+e.cidade+"', estado = '"+e.estado+"', ",a+="pais = '"+e.pais+"' WHERE id = "+e.id,this._execute(a,i)},updateMaterial:function(e,i,a,t){var n="UPDATE materiais SET id_pedido = "+i+", nome = '"+a.nome+"', marca = '"+a.marca+"', preco = '"+a.preco+"', ";n+="quantidade = "+a.quantidade+" WHERE id = "+e,this._execute(n,t)},updateInsumo:function(e,i,a,t){var n="UPDATE insumos SET id_pedido = "+i+", id_material = "+a.id_material+", descricao = '"+a.descricao+"', preco = '"+a.preco+"', ";n+="quantidade = "+a.quantidade+" WHERE id = "+e,this._execute(n,t)},_execute:function(e,i){mysqlQuery(e,i)}},Validator=function(e,i){var a={required:function(i){return e.is("select")?"-1"!=e.val()&&""!=e.val()&&null!=e.val()&&"null"!=e.val():e.is("input")||e.is("textarea")?e.val().length>0:void 0},max:function(i){return e.val().length<=i},min:function(i){return e.val().length>=i}},t=[];this.validate=function(e){for(var i in t){var n=t[i];if(!a[n.name]||!a[n.name](n.opt))return void e(n,!1)}e({},!0)},function(){var e=i.split("|");for(var a in e){var n=e[a].split(":");t[n[0]]={name:n[0],opt:n[1]}}}()},Pedido=function(){var e={},i={},a=[],t=[],n="";this.setAddress=function(i){for(var a in i)e[a]=i[a]},this.setData=function(i){e=i},this.getData=function(){return e},this.setSolicitante=function(e){i=e},this.getSolicitante=function(){return i},this.setMaterial=function(e){a=e},this.getMateriais=function(){return a},this.setInsumos=function(e){console.log("set insumos",t),t=e},this.getInsumos=function(){return console.log("get insumos",t),t},this.setInsurance=function(e){n=e},this.getInsurance=function(){return n},this.get=function(i){return e[i]}},FormWizard=function(e,i,a){var t=$(e),n=[];this.initializeFields=function(){var e=this;for(var n in i)this.initializeField(n,i[n]);this.btnSubmit=t.find(".btn-submit"),this.btnSubmit.click(function(){e.allValidate()&&a()})},this.reloadElements=function(){for(var e in i)i[e].el=$()},this.reload=function(){n=[];for(var e in i)this.initializeField(e,i[e]);this.validateAllFields()},this.initializeField=function(e,i){i.select?$elField=t.find('select[data-field="'+e+'"]'):$elField=t.find('input[data-field="'+e+'"], textarea[data-field="'+e+'"]'),n[e]={els:[],properties:i};for(var a=0;a<$elField.length;a++){var s=$($elField[a]);s.attr("data-index",a),n[e].els.push({el:s,status:!i.rules,validator:i.rules?new Validator(s,i.rules):null})}i.isDate&&this.startDatepicker(n[e]),i.mask&&o(n[e],i.mask,i.onCompleteMask),this.createEvents(n[e])};var o=function(e,i,a){var t={onComplete:a||function(){}};for(var n in e.els)e.els[n].el.mask(i,t)};this.startDatepicker=function(e){var i=this;for(var a in e.els)e.els[a].el.datepicker({format:"dd/mm/yyyy",language:"pt-BR",orientation:"bottom left"}).on("changeDate",function(t){e.els[a].validator&&i.validateField(e.els[a]),i.verifySubmitEnabled(),e.properties&&e.properties.onChangeDate(t)})},this.createEvents=function(e){var i=this;for(var a in e.els)e.els[a].el.is("input")?e.els[a].el.on("keyup",function(a){var t=n[$(this).data("field")].els[$(this).data("index")];t.validator&&i.validateField(t,e),e.properties.keyUp&&e.properties.keyUp(a,t),i.verifySubmitEnabled()}):e.els[a].el.on("change",function(a){console.log("change");var t=n[$(this).data("field")].els[$(this).data("index")];t.validator&&i.validateField(t,e),e.properties.keyUp&&e.properties.keyUp(a,t),i.verifySubmitEnabled()})},this.verifySubmitEnabled=function(){this.allValidate()?this.enableBtnSubmit():this.disableBtnSubmit()},this.validateField=function(e,i){$this=this,e.validator.validate(function(a,t){e.status=t,$this.validateFieldElement(e.el,i.properties,a,t)})},this.validateFieldElement=function(e,i,a,t){var n=e.parent();i.hasLoading&&(n=n.parent()),n.find(".validator-errors span").removeClass("show"),t?n.removeClass("has-error").addClass("has-success"):(n.find('.validator-errors span[data-error="'+a.name+'"]').addClass("show"),n.addClass("has-error"))},this.validateAllFields=function(){for(var e in n)for(var i in n[e].els){var a=n[e],t=n[e].els[i];t.validator?this.validateField(t,a):console.log("No validator ",e)}},this.allValidate=function(){for(var e in n)for(var i in n[e].els)if(!n[e].els[i].status)return!1;return!0},this.setValue=function(e){for(var i in e)n[i]&&(n[i].properties.select?n[i].els[0].el.val(e[i]):n[i].properties.isDate?(n[i].els[0].el.datepicker("update",this.getDate(e[i])),this.validateField(n[i].els[0],n[i])):n[i].els[0].el.attr("value",e[i]))},this.getDate=function(e){var i=e.split("-");return new Date(i[2],i[1],i[0])},this.setEnabled=function(e,i){if(Array.isArray(e))for(var a in e)n[e[a]]&&n[e[a]].els[0].el.removeAttr("disabled");else n[e].els[i].el.removeAttr("disabled")},this.setAllEnabled=function(){for(var e in n)for(var i in n[e].els)this.setEnabled(e,i)},this.setDisabled=function(e,i){if(Array.isArray(e))for(var a in e)n[e[a]]&&n[e[a]].els[0].el.attr("disabled","disabled");else n[e].els[i].el.attr("disabled","disabled")},this.enableBtnSubmit=function(){this.btnSubmit.removeAttr("disabled")},this.disableBtnSubmit=function(){this.btnSubmit.attr("disabled","disabled")},this.get=function(e){var i=[];for(var a in n[e].els)i.push(n[e].els[a].el.val());return 1==i.length?i[0]:i},this.unmask=function(e){return n[e].el.unmask()},this.getCleanValue=function(e){return n[e].els[0].el.cleanVal()},this.getAll=function(){var e={};for(var i in n)e[i]=n[i].els[0].el.val();return e},this.showLoading=function(e,i){n[e].els[i].el.parent().find(".image-loading").addClass("show fadeIn")},this.hideLoading=function(e,i){n[e].els[i].el.parent().find(".image-loading").removeClass("fadeIn show")},this.init=function(){t.on("submit",function(e){e.preventDefault()}),this.initializeFields()},this.init()},Paginator=function(e,i,a){var t=this,n=$(e),o=$(i),s={},r=function(){n.click(function(){$(this).hasClass("enabled")&&t.setSelectedPage($(this).attr("href").replace("#",""))})};this.init=function(){r()},this.loadHtml=function(e,i,a){$.ajax({url:"views/"+e+".html"}).done(function(e){i.find(".content").html(e),a()})},this.setSelectedPage=function(e){t=this,o.find(".page").removeClass("show-page").addClass("hide-page"),o.find(".page .loading").removeClass("hide"),o.find(".page .content").removeClass("show"),this.selectedPage=o.find("div[data-page="+e+"]"),this.selectedPage.addClass("show-page").removeClass("hide-page");var i=function(){t.selectedPage.find(".loading").addClass("hide"),t.selectedPage.find(".content").addClass("show")};s[e]?a(e,this.selectedPage.data("title"),i):this.loadHtml(e,this.selectedPage,function(){a(e,t.selectedPage.data("title"),i)})}},CEP={getInfo:function(e,i){$.getJSON("https://viacep.com.br/ws/"+e+"/json/",function(e){if(e.erro)i(e);else{var a={rua:e.logradouro,cidade:e.localidade,bairro:e.bairro,uf:e.uf,pais:"Brasil"};i(a)}})}},ChartPedidos={type:"line",labels:[],data:[],chart:null,el:null,label:"",init:function(e,i,a,t){this.label=i,this.el=e,this.labels=a,this.data=t,this.constructElement()},constructElement:function(){var e=document.getElementById(this.el);e.height=100,this.chart=new Chart(e,{type:this.type,data:{labels:this.labels,datasets:[{label:this.label,data:this.data,backgroundColor:["rgba(255, 99, 132, 0.2)"],borderColor:["rgba(255,99,132,1)"],borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})}},FormPedido=function(e,i,a){var t=null,n=null,o=0,s=0;this.init=function(){var e=this;t=new FormWizard(".form-wizard.form-pedido",{id:{keyUp:function(i,a){e.keyUpId(i,a)},hasLoading:!0},data_de_compra:{rules:"required",isDate:!0,onChangeDate:function(){}}},function(){e.submit()}),a()},this.submit=function(){var a=t.getAll();a.id=o,a.idSolicitante=s,i.setData(a),e.paginatorForms.setSelectedPage("formSolicitante")},this.keyUpId=function(e,i){i.status&&(clearTimeout(n),n=setTimeout(function(){""!=t.get("id")?(t.setDisabled(["id","data_de_compra"]),t.showLoading("id",0),Database.findPedidoById(t.get("id"),function(e){if(t.setEnabled(["id"]),1==e.length){e=e[0],t.setValue(e),t.verifySubmitEnabled(),e.total=e.total_materiais+e.total_insumos;var i=$(".fields-pedido");for(var a in e){var n=e[a];"total_materiais"!=a&&"total_insumos"!=a&&"total"!=a||(n=n.toFixed(2)),i.find('li[data-field="'+a+'"] span').text(n)}o=e.id,s=e.id_solicitante,$(".about-pedido").removeClass("hide")}else o=0,$(".about-pedido").addClass("hide");t.setEnabled(["data_de_compra"]),t.hideLoading("id",0)})):$(".about-pedido").addClass("hide")},1e3))},this.init()},FormSolicitante=function(e,i,a){var t=null,n=null;this.init=function(){var e=this;t=new FormWizard(".form-solicitante",{id:{},nome:{rules:"required|min:3|max:100"},telefone:{rules:"required",mask:"(00) 00000-0000"},cpf:{rules:"required",mask:"000.000.000-00",onCompleteMask:function(){e.searchSolicitante()},hasLoading:!0},cep:{rules:"required",mask:"00000-000",onCompleteMask:function(i){e.searchCep(i)},hasLoading:!0},rua:{rules:"required|min:3"},numero:{rules:"required"},complemento:{},estado:{rules:"required",select:!0},cidade:{rules:"required|min:3"}},function(){e.submit()}),this.load()},this.submit=function(){var a=t.getAll();a.cpf=t.getCleanValue("cpf"),a.cep=a.cep.replace("-",""),a.telefone=a.telefone.replace(" ",""),i.setSolicitante(a),e.paginatorForms.setSelectedPage("formMaterial")},this.load=function(){var e=this;0==i.get("id")?a():Database.findSolicitanteById(i.get("idSolicitante"),function(i){if(0==i.length)t.setEnabled(["cep","nome","telefone"]);else{var n=i[0];e.setValueForm(n),t.validateAllFields(),t.verifySubmitEnabled()}a()})},this.setValueForm=function(e){e.cpf=s(e.cpf),e.cep=r(e.cep),e.telefone=o(e.telefone),t.setValue(e),t.setAllEnabled()};var o=function(e){return $("<div>"+e.replace("(").replace(")")+"</div>").mask("(00) 00000-0000").text()},s=function(e){return $("<div>"+e+"</div>").mask("000.000.000-00").text()},r=function(e){return $("<div>"+e+"</div>").mask("00000-000").text()};this.searchCep=function(e){var i=["cep","rua","numero","complemento","cidade","uf"];t.setDisabled(i),CEP.getInfo(e,function(e){t.setValue(e),t.setEnabled(i)})},this.searchSolicitante=function(){var e=this;clearTimeout(n),n=setTimeout(function(){t.setDisabled(["cpf"]);var i=t.getCleanValue("cpf");t.showLoading("cpf"),Database.findSolicitanteByCpf(i,function(i){0==i.length?t.setEnabled(["cep","nome","telefone"]):(e.setValueForm(i[0]),t.validateAllFields(),t.verifySubmitEnabled()),t.hideLoading("cpf")})},1e3)},this.init()},FormMaterial=function(e,i,a){var t=null;this.init=function(){var e=this;t=new FormWizard(".form-wizard.form-material",{id:{},nome:{rules:"required"},marca:{rules:"required"},quantidade:{rules:"required"},preco:{rules:"required"}},function(){e.submit()}),$(".btn-add-material").click(function(){e.addMaterial({})}),this.load()},this.submit=function(){i.setMaterial(this.constructObject(t.get("id"),t.get("nome"),t.get("marca"),t.get("quantidade"),t.get("preco"))),e.paginatorForms.setSelectedPage("formInsumo")},this.constructObject=function(e,i,a,t,n){if(Array.isArray(e)){var o=[];for(var s in e)o.push({id:e[s],nome:i[s],marca:a[s],quantidade:t[s],preco:n[s]});return o}return[{id:e,nome:i,marca:a,quantidade:t,preco:n}]},this.htmlMaterial=function(e){return'<li class="list-group-item"><input type="hidden" data-field="id" name="id[]" class="form-control" value="'+(e.id?e.id:0)+'" id="id"><div class="form-group"><label for="nome" class="control-label">Nome</label><input type="text" value="'+(e.nome?e.nome:"")+'" name="nome[]" class="form-control" data-field="nome" placeholder="Nome"></div><div class="row"><div class="col col-md-4"><div class="form-group"><label for="marca" class="control-label">Marca</label><input type="text" name="marca[]" class="form-control" value="'+(e.marca?e.marca:"")+'" data-field="marca" placeholder="Marca"></div></div><div class="col col-md-3"><div class="form-group"><label for="quantidade" class="control-label">Quantidade</label><input type="number" name="quantidade[]" class="form-control" value="'+(e.quantidade?e.quantidade:0)+'" data-field="quantidade" placeholder="Quantidade"></div></div><div class="col col-md-5"><div class="form-group"><label for="preco" class="control-label">Preço R$</label><input type="number" name="preco[]" value="'+(e.preco?e.preco:0)+'" class="form-control" data-field="preco" placeholder="Preço"></div></div></div></li>'},this.addMaterial=function(e){$(".list-group.list-material").append(this.htmlMaterial(e)),t.reload()},this.load=function(){var e=this,n=i.get("id");(n=!n)?a():Database.findMaterialByIdPedido(i.get("id"),function(i){if(i.length>0){$(".list-group.list-material").html("");for(var n in i)e.injectHtmlMaterial(i[n]);t.reload(),a()}else a()})},this.injectHtmlMaterial=function(e){$(".list-group.list-material").append(this.htmlMaterial(e))},this.init()},FormInsumo=function(e,i,a){var t=null,n="";this.init=function(){var e=this;t=new FormWizard(".form-wizard.form-insumo",{id:{},descricao:{rules:"required"},id_material:{rules:"required",select:!0},quantidade:{rules:"required"},preco:{rules:"required"}},function(){e.submit()}),$(".btn-add-insumo").click(function(){e.addInsumo({})}),this.load()},this.submit=function(){i.setInsumos(this.constructObject(t.get("id"),t.get("descricao"),t.get("id_material"),t.get("quantidade"),t.get("preco"))),e.paginatorForms.setSelectedPage("formAddress")},this.constructObject=function(e,i,a,t,n){if(Array.isArray(e)){var o=[];for(var s in e)o.push({id:e[s],descricao:i[s],id_material:a[s],quantidade:t[s],preco:n[s]});return o}return[{id:e,descricao:i,id_material:a,quantidade:t,preco:n}]},this.htmlInsumo=function(e){return'<li class="list-group-item"><input type="hidden" name="id[]" data-field="id" value="'+(e.id?e.id:0)+'" class="form-control" id="id"><div class="form-group"><label class="control-label">Descrição</label><textarea class="form-control" name="descricao" id="descricao" data-field="descricao" rows="3">'+(e.descricao?e.descricao:"")+'</textarea></div><div class="row"><div class="col col-md-4"><div class="form-group"><label class="control-label">Material</label><select name="material" class="form-control sel-material" data-field="id_material"><option disabled="disabled" value="-1" selected="selected">Selecione um material</option>'+n+'</select></div></div><div class="col col-md-3"><div class="form-group"><label for="quantidade" class="control-label">Quantidade</label><input type="number" name="quantidade[]" value="'+(e.quantidade?e.quantidade:0)+'" class="form-control" data-field="quantidade" placeholder="Quantidade"></div></div><div class="col col-md-5"><div class="form-group"><label for="preco" class="control-label">Preço R$</label><input type="number" name="preco[]" value="'+(e.preco?e.preco:0)+'" class="form-control" data-field="preco" placeholder="Preço"></div></div></div></li>'},this.addInsumo=function(e){$(".list-group.list-insumos").append(this.htmlInsumo(e)),t.reload()},this.load=function(){var e=this;this.createSelectMaterial();var n=i.get("id");(n=!n)?a():Database.findInsumoByIdPedido(i.get("id"),function(i){if(i.length>0){$(".list-group.list-insumos").html("");for(var n in i)e.injectHtmlInsumo(i[n]);t.reload(),a()}else a()})},this.createSelectMaterial=function(){var e=i.getMateriais();for(var a in e)console.log(e),n='<option value="'+(0==e[a].id?a:e[a].id)+'">'+e[a].nome+"</option>"},this.injectHtmlInsumo=function(e){var i=$(this.htmlInsumo(e));e.id_material&&i.find(".sel-material").val(e.id_material),$(".list-group.list-insumos").append(i)},this.init()},FormAddress=function(e,i,a){var t=null,n=null;this.init=function(){var e=this,a=i.getSolicitante();t=new FormWizard(".form-address",{cep:{rules:"required",mask:"00000-000",onCompleteMask:function(i){e.searchCep(i)},hasLoading:!0},rua:{rules:"required|min:3"},numero:{rules:"required"},complemento:{},estado:{rules:"required",select:!0},cidade:{rules:"required|min:3"}},function(){e.submit()}),this.setValueForm(a)},this.submit=function(){(n={}).cep=t.get("cep").replace("-",""),n.rua=t.get("rua"),n.complemento=t.get("complemento"),n.numero=t.get("numero"),n.estado=t.get("estado"),n.cidade=t.get("cidade"),i.setAddress(n),e.paginatorForms.setSelectedPage("formInsurance")};var o=function(e){return $("<div>"+e+"</div>").mask("00000-000").text()};this.setValueForm=function(e){(n={}).cep=o(e.cep),n.rua=e.rua,n.complemento=e.complemento,n.numero=e.numero,n.estado=e.estado,n.cidade=e.cidade,t.setValue(n),t.setAllEnabled(),t.validateAllFields(),t.verifySubmitEnabled(),a()},this.searchCep=function(e){var i=["cep","rua","numero","complemento","cidade","uf"];t.setDisabled(i),CEP.getInfo(e,function(e){t.setValue(e),t.setEnabled(i)})},this.init()},FormInsurance=function(e,i,a){var t=null,n="";this.init=function(){var e=this;(t=$(".form-insurance")).find(".btn-submit").click(function(){e.submit()}),t.find(".insurance").on("change",function(){n=$(this).val(),e.checkEnabledSubmit()}),a()},this.submit=function(){i.setInsurance(n),e.paginatorForms.setSelectedPage("formResumo")},this.checkEnabledSubmit=function(){""!=n&&t.find(".btn-submit").removeAttr("disabled")},this.init()},FormResumo=function(e,i,a){var t=null;this.init=function(){var e=this;t=$(".form-resumo"),this.setValueForPedido(),this.setValuesForSolicitante(),this.setValuesForMateriais(),this.setValuesForInsumos(),this.setValuesForInsurance(),t.find(".btn-submit").click(function(){e.submit()}),a()},this.submit=function(){e.paginatorForms.setSelectedPage("formFinish")},this.setValueForPedido=function(){var e=t.find('.info[data-info="pedido"]'),a=i.getData();this.setValue(e,a)},this.setValuesForSolicitante=function(){var e=t.find('.info[data-info="solicitante"]'),a=i.getSolicitante();this.setValue(e,a)},this.getHtmlMaterial=function(e){return'<li class="list-group-item"><div class="form-group"><label for="nome" class="control-label">Nome</label><span data-field="nome"></span>'+e.nome+'</div><div class="row"><div class="col col-md-4"><div class="form-group"><label for="marca" class="control-label">Marca</label><span data-field="marca">'+e.marca+'</span></div></div><div class="col col-md-3"><div class="form-group"><label for="quantidade" class="control-label">Quantidade</label><span data-field="quantidade">'+e.quantidade+'</span></div></div><div class="col col-md-5"><div class="form-group"><label for="preco" class="control-label">Preço R$</label><span data-field="preco">'+e.preco+"</span></div></div></div></li>"},this.setValuesForMateriais=function(){var e=i.getMateriais();for(var a in e)t.find(".list-material").append(this.getHtmlMaterial(e[a]))},this.getHtmlInsumo=function(e){return'<li class="list-group-item"><div class="form-group"><label class="control-label">Descrição</label><span data-field="descricao">'+e.descricao+'</span></div><div class="row"><div class="col col-md-4"><div class="form-group"><label class="control-label">Material</label><span data-field="material">'+e.id_material+'</span></div></div><div class="col col-md-3"><div class="form-group"><label for="quantidade" class="control-label">Quantidade</label><span data-field="quantidade">'+e.quantidade+'</span></div></div><div class="col col-md-5"><div class="form-group"><label for="preco" class="control-label">Preço R$</label><span data-field="preco">'+e.preco+"</span></div></div></div></li>"},this.setValuesForInsumos=function(){var e=i.getInsumos();for(var a in e)t.find(".list-insumos").append(this.getHtmlInsumo(e[a]))},this.setValuesForInsurance=function(){var e=i.getInsurance(),a="";console.log(e),a="s"==e?"Optou pelo seguro extra":"Não optou pelo seguro extra",t.find(".insurance").text(a)},this.setValue=function(e,i){for(var a in i){var t=e.find('span[data-field="'+a+'"]');t&&t.text(i[a])}},this.init()},FormFinish=function(e,i,a){this.init=function(){a()},this.mergeSolicitante=function(){var e=i.getSolicitante();0==e.id?Database.insertSolicitante(e,function(e){console.log(e)}):Database.updateSolicitante(e,function(e){console.log(e)})},this.init()},Core={paginatorMenu:null,paginatorForms:null,validator:null,formPedido:null,formSolicitante:null,formMaterial:null,formInsumo:null,formInsurance:null,formAddress:null,formResumo:null,pedido:null,init:function(){var e=this;this.paginatorMenu=new Paginator(".page-change",".paginator",function(i,a,t){e.pages[i](e,t)}),this.paginatorMenu.init(),String.prototype.replaceAll=function(e,i){return this.replace(new RegExp(e,"g"),i)},this.paginatorMenu.setSelectedPage("dashboard1"),$(".change-sub-navbar").click(function(){e.changeSubNavbar($(this).data("subnavbar"))}),$(".navbar .navbar-nav a").click(function(){$(".navbar .navbar-nav li").removeClass("active"),$(this).addClass("active")})},changeSubNavbar:function(e){$(".sub-navbar").addClass("hide"),$(".sub-navbar."+e).removeClass("hide")},pages:{dashboard1:function(e,i){Database.fetchPedidosPorDia(function(a){a=e.prepareResultPorDia(a),ChartPedidos.init("chartOne","# pedidos por dia",a.labels,a.data),i()})},dashboard2:function(e,i){Database.fetchPedidosPorSolicitantes(function(a){a=e.prepareResultPorSolicitante(a),ChartPedidos.init("chartTwo","# pedidos por solicitante",a.labels,a.data),i()})},dashboard3:function(e,i){Database.fetchAllPedidos(function(e){var a=[];for(var t in e){var n=Number(e[t].total_materiais)+Number(e[t].total_insumos);a.push([e[t].numero,e[t].nome,e[t].data_de_compra.replaceAll("-","/"),"R$ "+e[t].total_materiais.toFixed(2),"R$ "+e[t].total_insumos.toFixed(2),"R$ "+n.toFixed(2)])}$("#table-pedidos").DataTable({columns:[{title:"Numero"},{title:"Solicitante"},{title:"Data de compra"},{title:"Total em Materiais"},{title:"Total em Insumos"},{title:"Total da compra"}],data:a}),i()})},process:function(e,i){e.pedido||(e.pedido=new Pedido),e.paginatorForms=new Paginator("--",".paginator.forms",function(i,a,t){e.changeTitleHeader(a),console.log("Change page",i),"formPedido"==i?e.formPedido||(e.formPedido=new FormPedido(e,e.pedido,t)):"formSolicitante"==i?e.formSolicitante||(e.formSolicitante=new FormSolicitante(e,e.pedido,t)):"formMaterial"==i?e.formMaterial||(e.formMaterial=new FormMaterial(e,e.pedido,t)):"formInsumo"==i?e.formInsumo||(e.formInsumo=new FormInsumo(e,e.pedido,t)):"formAddress"==i?e.formAddress||(e.formAddress=new FormAddress(e,e.pedido,t)):"formInsurance"==i?e.formInsurance||(e.formInsurance=new FormInsurance(e,e.pedido,t)):"formResumo"==i?e.formResumo||(e.formResumo=new FormResumo(e,e.pedido,t)):"formFinish"==i&&(e.formFinish||(e.formFinish=new FormFinish(e,e.pedido,t)))}),e.paginatorForms.init(),e.paginatorForms.setSelectedPage("formPedido"),i()}},changeTitleHeader:function(e){$(".title-header h2").text(e)},prepareResultPorSolicitante:function(e){var i={labels:[],data:[]};for(var a in e)i.labels.push(e[a].nome),i.data.push(e[a].total);return i},prepareResultPorDia:function(e){var i={data:[],labels:[]};for(var a in e)i.labels.push(this.prepareNumber(e[a].day)),i.data.push(e[a].total);return i},prepareNumber:function(e){return e<10?"0"+e:e}};Core.init();