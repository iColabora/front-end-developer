"use strict";angular.module("appShipment",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","appShipment.pedidos"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/pedidos.html",controller:"TasksCtrl",controllerAs:"task",resolve:{pedidosPorDia:["pedidos",function(a){return a.getPedidosPorDia()}]}}).when("/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl",controllerAs:"dash",resolve:{pedidos:["pedidos",function(a){return a.getPedidos()}],materiais:["pedidos",function(a){return a.getMateriais()}],insumos:["pedidos",function(a){return a.getInsumos()}]}}).when("/solicitantes",{templateUrl:"views/solicitantes.html",controller:"SolicitantesCtrl",controllerAs:"solicitantes",resolve:{pedidosPorSolicitante:["pedidos",function(a){return a.getPedidosPorSolicitante()}]}}).when("/pedidosPendentes",{templateUrl:"views/pedidospendentes.html",controller:"PedidospendentesCtrl",controllerAs:"pedidosPendentes"}).otherwise({redirectTo:"/"})}]).controller("geralCtrl",["$scope","$location",function(a,b){a.playProcesso=function(){window.location.replace("#/dashboard")}}]),angular.module("appShipment").controller("DashboardCtrl",["pedidos","materiais","insumos",function(a,b,c){var d=this;d.pedidos=a,d.materiais=b,d.insumos=c,d.somaTotal=function(a){if("undefined"==typeof b||"undefined"==typeof a)return 0;for(var d=0,e=0;e<b.length;e++)b[e].numero==a&&(d+=b[e].quantidade*b[e].preco);for(var e=0;e<c.length;e++)c[e].numero==a&&(d+=c[e].quantidade*c[e].preco);return d},d.getInsumo=function(a){var b=[];return c.map(function(c){c.id_material==a&&b.push(c)}),b},d.openTicket=function(a){var b=angular.element(a.currentTarget);b.parent().hasClass("open")?b.parent().removeClass("open"):b.parent().addClass("open")},d.dateFormat=function(a){var b=new Date(a);return console.log(b),b}}]),angular.module("appShipment").controller("TasksCtrl",["pedidosPorDia",function(a){var b=this;b.pedidos=a;var c=[],d={labels:[],datasets:[{label:"Numero de vendas no dia",backgroundColor:"rgba(56, 187, 157, 0.2)",borderColor:"rgba(56, 187, 157, 1)",borderWidth:1,data:[]}]};a.map(function(a){for(var b=!1,d=0;d<c.length;d++)c[d].data==a.data_de_compra&&(c[d].total+=1,b=!0);0==c.length&&c.push({total:1,data:a.data_de_compra}),b||c.push({total:1,data:a.data_de_compra})});var e=[];e[0]="Jan",e[1]="Feb",e[2]="Mar",e[3]="Abr",e[4]="Mai",e[5]="Jun",e[6]="Jul",e[7]="Ago",e[8]="Set",e[9]="Out",e[10]="Nov",e[11]="Dez",c.map(function(a){var b=new Date(a.data);d.labels.push(b.getDate()+"/"+e[b.getMonth()]),d.datasets[0].data.push(a.total)}),setTimeout(function(){var a=document.getElementById("chartPedido");new Chart(a,{type:"line",data:d})},0)}]),angular.module("appShipment.pedidos",[]).factory("pedidos",["$http","$q",function(a,b){function c(b,c){return a.get("http://192.241.152.185/"+b).success(function(a){var b=JSON.stringify(a);return b=JSON.parse(b),c.resolve(b)}).error(function(a){return c.reject(pedidos)}),c.promise}var d={};return d.getPedidos=function(){var a=b.defer(),d="SELECT pedidos.numero, pedidos.data_de_compra, solicitantes.nome FROM pedidos JOIN solicitantes ON pedidos.id_solicitante=solicitantes.id GROUP BY pedidos.numero ORDER BY pedidos.data_de_compra ASC";return c(d,a)},d.getInsumos=function(){var a=b.defer(),d="SELECT insumos.descricao, insumos.quantidade, insumos.preco, insumos.id_material, pedidos.numero, materiais.nome FROM insumos JOIN pedidos ON pedidos.id=insumos.id_pedido JOIN materiais ON materiais.id=insumos.id_material ORDER BY pedidos.numero ASC";return c(d,a)},d.getMateriais=function(){var a=b.defer(),d="SELECT materiais.id, materiais.nome, materiais.marca, materiais.preco, materiais.quantidade, pedidos.numero FROM materiais JOIN pedidos ON pedidos.id=materiais.id_pedido ORDER BY pedidos.numero ASC";return c(d,a)},d.getPedidosPorSolicitante=function(){var a=b.defer(),d="SELECT DATE(pedidos.data_de_compra) AS data_de_compra, pedidos.numero, solicitantes.nome, solicitantes.id FROM pedidos JOIN solicitantes ON solicitantes.id=pedidos.id_solicitante ORDER BY data_de_compra ASC ";return c(d,a)},d.getPedidosPorDia=function(){var a=b.defer(),d="SELECT DATE(pedidos.data_de_compra) AS data_de_compra, pedidos.numero, solicitantes.nome FROM pedidos JOIN solicitantes ON solicitantes.id=pedidos.id_solicitante ORDER BY data_de_compra ASC ";return c(d,a)},d}]),angular.module("appShipment").controller("SolicitantesCtrl",["pedidosPorSolicitante",function(a){var b=this;b.pedidos=a;var c=[],d={labels:[],datasets:[{label:"Número de pedidos",backgroundColor:"rgba(56, 187, 157, 0.2)",borderColor:"rgba(56, 187, 157, 1)",borderWidth:1,data:[]}]};a.map(function(a){for(var b=!1,d=0;d<c.length;d++)c[d].solicitante==a.nome&&(c[d].total+=1,b=!0);0==c.length&&c.push({total:1,solicitante:a.nome}),b||c.push({total:1,solicitante:a.nome})}),c.map(function(a){new Date(a.data);d.labels.push(a.solicitante),d.datasets[0].data.push(a.total)}),setTimeout(function(){var a=document.getElementById("chartSolicitante");new Chart(a,{type:"bar",data:d,options:{scales:{yAxes:[{ticks:{min:0}}]}}})},0)}]),angular.module("appShipment").controller("PedidospendentesCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("appShipment").run(["$templateCache",function(a){a.put("views/dashboard.html",'<div class="col-md-6"> <div class="panel panel-default"> <div class="panel-heading"> <h3><strong>Pedidos </strong></h3> <div class="input-group input-pesquisa"> <input type="text" class="form-control" id="pesquisaProduto" placeholder="Faça sua pesquisa" aria-describedby="basic-addon2"> <label for="pesquisaProduto" class="input-group-addon" id="basic-addon2"><i class="fa fa-search" aria-hidden="true"></i></label> </div> </div> <div class="panel-body"> <div ng-repeat="pedido in dash.pedidos" id="ticketPedido" ng-class="$index == 0 ? \'open col-sm-12\' : \'col-sm-12\'"> <div class="ticket-head row" ng-click="dash.openTicket($event)"> <h4> <strong>PEDIDO</strong> {{ pedido.numero }} <small> realizado dia {{ dash.dateFormat(pedido.data_de_compra) | date : \'dd MMM yyyy\' : \'UTC-03:00\' }} </small> </h4> <ul class="ticket-nav"> <li class="expand"><i class="fa fa-expand" aria-hidden="true"></i><i class="fa fa-compress" aria-hidden="true"></i></li> </ul> </div> <div class="ticket-body"> <div class="col-md-12"> <ul> <li><strong>Solicitante: </strong> {{ pedido.nome }}</li> <li><a class="btn-detalhes" href="">Ver detalhes</a></li> </ul> </div> <div class="col-sm-12"> <small>LISTA DE ITENS DO PEDIDO</small> <table class="table table-responsive table-bordered table-striped"> <thead> <tr> <th class="text-center">Material</th> <th class="text-center">Marca</th> <th class="text-center">Preço/Uni.</th> <th class="text-center">Quantidade</th> <th class="text-center">Total</th> </tr> </thead> <tbody> <tr class="text-center" ng-repeat="material in dash.materiais" ng-if="material.numero == pedido.numero"> <td>{{ material.nome}} {{ idMaterial }}</td> <td>{{ material.marca}}</td> <td>{{ material.preco | currency:"R$":2 }}</td> <td>{{ material.quantidade}}</td> <td class="text-right">{{ material.preco * material.quantidade | currency:"R$":2 }} </td> </tr> <tr> <th class="text-center">Material</th> <th class="text-center">Insumo</th> <th class="text-center"><i class="fa fa-chevron-down" aria-hidden="true"></i></th> <th class="text-center"><i class="fa fa-chevron-down" aria-hidden="true"></i></th> <th class="text-center"><i class="fa fa-chevron-down" aria-hidden="true"></i></th> </tr> <tr class="text-center" ng-repeat="insumo in dash.insumos" ng-if="insumo.numero == pedido.numero"> <td>{{ insumo.nome }}</td> <td>{{ insumo.descricao}}</td> <td>{{ insumo.preco | currency:"R$":2 }}</td> <td>{{ insumo.quantidade}}</td> <td class="text-right">{{ insumo.preco * insumo.quantidade | currency:"R$":2 }} </td> </tr> </tbody> </table> <table class="table table-responsive table-bordered table-striped"> <thead> </thead> <tbody> </tbody> </table> <div class="col-sm-12 text-right total-pedido"> <strong>TOTAL </strong><span>{{ dash.somaTotal(pedido.numero) | currency:"R$":2 }}</span> </div> </div> </div> <!-- END: ticket-body  --> </div> <!-- END: TicketPedido --> </div> </div> </div> <div class="col-md-6"> <div class="panel panel-default"> <div class="panel-heading"> <h3><strong>Dados do </strong>Pedido</h3> </div> <div class="panel-body"> </div> </div> </div>'),a.put("views/pedidos.html",'<div class="panel panel-uniq panel-default"> <div class="panel-heading"> <h3><strong>Relatório de </strong>Pedidos</h3> </div> <div class="panel-body"> <canvas id="chartPedido" height="100px"></canvas> <div class="clearfix"></div> <table class="table table-responsive table-bordered table-striped"> <thead> <tr> <th class="text-center"> Pedido </th> <th class="text-center"> Data </th> <th class="text-center"> Solicitante </th> </tr> </thead> <tbody> <tr ng-repeat="pedido in task.pedidos" class="text-center"> <td>{{ pedido.numero }}</td> <td>{{ pedido.data_de_compra | date : \'dd MMM yyyy\' : \'UTC-03:00\' }}</td> <td>{{ pedido.nome }}</td> </tr> </tbody> </table> </div> </div>'),a.put("views/pedidospendentes.html",'<div class="panel panel-uniq panel-default"> <div class="panel-heading"> <h3><strong>Pedidos </strong>Pendentes</h3> </div> <div class="panel-body"> </div> </div>'),a.put("views/solicitantes.html",'<div class="panel panel-uniq panel-default"> <div class="panel-heading"> <h3><strong>Relatório de </strong>Solicitantes</h3> </div> <div class="panel-body"> <canvas id="chartSolicitante" height="100px"></canvas> <div class="clearfix"></div> <table class="table table-responsive table-bordered table-striped"> <thead> <tr> <th class="text-center"> Pedido </th> <th class="text-center"> Data </th> <th class="text-center"> Solicitante </th> </tr> </thead> <tbody> <tr ng-repeat="pedido in solicitantes.pedidos" class="text-center"> <td>{{ pedido.numero }}</td> <td>{{ pedido.data_de_compra | date : \'dd MMM yyyy\' : \'UTC-03:00\' }}</td> <td>{{ pedido.nome }}</td> </tr> </tbody> </table> </div> </div>')}]);